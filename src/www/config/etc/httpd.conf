ext_ip = "egress"

types {
  include "/usr/share/misc/mime.types"
}


server "s-expressions.org" {
    alias "www.s-expressions.org"
    
    listen on $ext_ip port 80

    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    block return 301 "https://$SERVER_NAME$REQUEST_URI"
}

server "s-expressions.org" {

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }
    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    block return 302 "https://www.$SERVER_NAME$REQUEST_URI"
}


server "www.s-expressions.org" {

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }

    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    
    location "/sitemap.xml" {
        root "/htdocs/resources"
    }
    location "/robots.txt" {
        root "/htdocs/resources"
    }
    location "/favicon.ico" {
        root "/htdocs/resources/icons"
    }

    location "/icons/*" {
        root "/htdocs/resources"
    }

    location "/images/*" {
        root "/htdocs/resources"
    }

    location "/fonts/*" {
        root "/htdocs/resources"
    }

    location "/styles/*" {
        root "/htdocs/resources"
    }
    location "/scripts/*" {
        root "/htdocs/resources"
    }

    directory { auto index } 

    root "/htdocs/pages"

    location "/" {
        block return 301 "https://$SERVER_NAME/home"
#        request rewrite "/home.html"
    }

    location "/home" { request rewrite "$REQUEST_URI.html" }
    
    location "/organization" { request rewrite "$REQUEST_URI.html" }
    location "/organization/" { block return 302 "https://$SERVER_NAME/organization" }

    location "/standards" { request rewrite "$REQUEST_URI.html" }
    location "/standards/" { block return 302 "https://$SERVER_NAME/standards" }

    location "/projects" { request rewrite "$REQUEST_URI.html" }
    location "/projects/" { block return 302 "https://$SERVER_NAME/projects" }

    location "/contact" { request rewrite "$REQUEST_URI.html" }
    location "/contact/" { block return 302 "https://$SERVER_NAME/contacts" }

    location "/privacy-policy" { request rewrite "$REQUEST_URI.html" }
    location "/privacy-policy/" { block return 302 "https://$SERVER_NAME/privacy-policy" }
    
    location "/terms-and-conditions" { request rewrite "$REQUEST_URI.html" }
    location "/terms-and-conditions/" { block return 302 "https://$SERVER_NAME/terms-and-conditions" }

    location "/site-map" { request rewrite "$REQUEST_URI.html" }
    location "/site-map/" { block return 302 "https://$SERVER_NAME/site-map" }

    
    location "/projects/dsl/overview" { request rewrite "$REQUEST_URI.html" }
    location "/projects/dsl/overview/" { block return 302 "https://$SERVER_NAME/projects/dsl/overview" }


    location "/projects/pose/abstract" { request rewrite "$REQUEST_URI.html" }
    location "/projects/pose/abstract/" { block return 302 "https://$SERVER_NAME/projects/pose/abstract" }

    location "/projects/pose/examples" { request rewrite "$REQUEST_URI.html" }
    location "/projects/pose/examples/" { block return 302 "https://$SERVER_NAME/projects/pose/examples" }

    location "/projects/pose/rationale" { request rewrite "$REQUEST_URI.html" }
    location "/projects/pose/rationale/" { block return 302 "https://$SERVER_NAME/projects/pose/rationale" }

    location "/projects/pose/specification" { request rewrite "$REQUEST_URI.html" }
    location "/projects/pose/specification/" { block return 302 "https://$SERVER_NAME/projects/pose/specification" }


    location "/projects/s-mark/overview" { request rewrite "$REQUEST_URI.html" }
    location "/projects/s-mark/overview/" { block return 302 "https://$SERVER_NAME/projects/s-mark/overview" }


    location "/projects/twinjo/overview" { request rewrite "$REQUEST_URI.html" }
    location "/projects/twinjo/overview/" { block return 302 "https://$SERVER_NAME/projects/twinjo/overview" }

    location "/projects/twinjo/specification" { request rewrite "$REQUEST_URI.html" }
    location "/projects/twinjo/specification/" { block return 302 "https://$SERVER_NAME/projects/twinjo/specification" }

    location "/*" {

        request rewrite "/page-not-found.html"
    }
    
   
}




