ext_ip = "egress"

types {
  include "/usr/share/misc/mime.types"
}


server "s-expressions.org" {
    alias "www.s-expressions.org"

    alias "dsl.s-expressions.org"
    alias "www.dsl.s-expressions.org"
    alias "pose.s-expressions.org"
    alias "www.pose.s-expressions.org"
    alias "s-mark.s-expressions.org"
    alias "www.s-mark.s-expressions.org"
    alias "twinjo.s-expressions.org"
    alias "www.twinjo.s-expressions.org"
    
    listen on $ext_ip port 80

    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    block return 301 "https://$SERVER_NAME$REQUEST_URI"
}

server "s-expressions.org" {

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }
    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    location "/*" {
        block return 302 "https://www.$SERVER_NAME$REQUEST_URI"
    }
}

server "dsl.s-expressions.org" {
    alias "www.dsl.s-expressions.org"

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }
    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    location "/sitemap.xml" {
        root "/htdocs/resources"
    }
    location "/robots.txt" {
        root "/htdocs/resources"
    }
    location "/favicon.ico" {
        root "/htdocs/resources/icons"
    }

    location "/icons/*" {
        root "/htdocs/resources"
    }

    location "/images/*" {
        root "/htdocs/resources"
    }

    location "/fonts/*" {
        root "/htdocs/resources"
    }

    location "/styles/*" {
        root "/htdocs/resources"
    }
    location "/scripts/*" {
        root "/htdocs/resources"
    }
    
    root "/htdocs/pages"

    location "/overview" { request rewrite "/projects/dsl/overview.html" }
    location "/overview/" { block return 302 "https://$SERVER_NAME/overview" }

    location "/*" {
        request rewrite "/page-not-found.html"
    }
}
server "pose.s-expressions.org" {
    alias "www.pose.s-expressions.org"

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }
    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    location "/sitemap.xml" {
        root "/htdocs/resources"
    }
    location "/robots.txt" {
        root "/htdocs/resources"
    }
    location "/favicon.ico" {
        root "/htdocs/resources/icons"
    }

    location "/icons/*" {
        root "/htdocs/resources"
    }

    location "/images/*" {
        root "/htdocs/resources"
    }

    location "/fonts/*" {
        root "/htdocs/resources"
    }

    location "/styles/*" {
        root "/htdocs/resources"
    }
    location "/scripts/*" {
        root "/htdocs/resources"
    }
    
    root "/htdocs/pages"

    location "/abstract" { request rewrite "/projects/pose/abstract.html" }
    location "/abstract/" { block return 302 "https://$SERVER_NAME/abstract" }

    location "/examples" { request rewrite "/projects/pose/examples.html" }
    location "/examples/" { block return 302 "https://$SERVER_NAME/examples" }

    location "/rationale" { request rewrite "/projects/pose/rationale.html" }
    location "/rationale/" { block return 302 "https://$SERVER_NAME/rationale" }

    location "/specification" { request rewrite "/projects/pose/specification.html" }
    location "/specification/" { block return 302 "https://$SERVER_NAME/specification" }
    
    location "/*" {
        request rewrite "/page-not-found.html"
    }
}
server "s-mark.s-expressions.org" {
    alias "www.s-mark.s-expressions.org"

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }
    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    location "/sitemap.xml" {
        root "/htdocs/resources"
    }
    location "/robots.txt" {
        root "/htdocs/resources"
    }
    location "/favicon.ico" {
        root "/htdocs/resources/icons"
    }

    location "/icons/*" {
        root "/htdocs/resources"
    }

    location "/images/*" {
        root "/htdocs/resources"
    }

    location "/fonts/*" {
        root "/htdocs/resources"
    }

    location "/styles/*" {
        root "/htdocs/resources"
    }
    location "/scripts/*" {
        root "/htdocs/resources"
    }
    
    root "/htdocs/pages"

    location "/overview" { request rewrite "/projects/s-mark/overview.html" }
    location "/overview/" { block return 302 "https://$SERVER_NAME/overview" }

    location "/*" {
        request rewrite "/page-not-found.html"
    }
}

server "twinjo.s-expressions.org" {
    alias "www.twinjo.s-expressions.org"

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }
    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    location "/sitemap.xml" {
        root "/htdocs/resources"
    }
    location "/robots.txt" {
        root "/htdocs/resources"
    }
    location "/favicon.ico" {
        root "/htdocs/resources/icons"
    }

    location "/icons/*" {
        root "/htdocs/resources"
    }

    location "/images/*" {
        root "/htdocs/resources"
    }

    location "/fonts/*" {
        root "/htdocs/resources"
    }

    location "/styles/*" {
        root "/htdocs/resources"
    }
    location "/scripts/*" {
        root "/htdocs/resources"
    }
    
    root "/htdocs/pages"

    location "/overview" { request rewrite "/projects/twinjo/overview.html" }
    location "/overview/" { block return 302 "https://$SERVER_NAME/overview" }

    location "/specification" { request rewrite "/projects/twinjo/specification.html" }
    location "/specification/" { block return 302 "https://$SERVER_NAME/specification" }


    location "/*" {
        request rewrite "/page-not-found.html"
    }
}

server "www.s-expressions.org" {

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }

    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    
    location "/sitemap.xml" {
        root "/htdocs/resources"
    }
    location "/robots.txt" {
        root "/htdocs/resources"
    }
    location "/favicon.ico" {
        root "/htdocs/resources/icons"
    }

    location "/icons/*" {
        root "/htdocs/resources"
    }

    location "/images/*" {
        root "/htdocs/resources"
    }

    location "/fonts/*" {
        root "/htdocs/resources"
    }

    location "/styles/*" {
        root "/htdocs/resources"
    }
    location "/scripts/*" {
        root "/htdocs/resources"
    }

    directory { auto index } 

    root "/htdocs/pages"

    location "/" {
        block return 301 "https://$SERVER_NAME/home"
#        request rewrite "/home.html"
    }

    location "/home" { request rewrite "$REQUEST_URI.html" }
    
    location "/organization" { request rewrite "$REQUEST_URI.html" }
    location "/organization/" { block return 302 "https://$SERVER_NAME/organization" }

    location "/standards" { request rewrite "$REQUEST_URI.html" }
    location "/standards/" { block return 302 "https://$SERVER_NAME/standards" }

    location "/projects" { request rewrite "$REQUEST_URI.html" }
    location "/projects/" { block return 302 "https://$SERVER_NAME/projects" }

    location "/contact" { request rewrite "$REQUEST_URI.html" }
    location "/contact/" { block return 302 "https://$SERVER_NAME/contacts" }

    location "/privacy-policy" { request rewrite "$REQUEST_URI.html" }
    location "/privacy-policy/" { block return 302 "https://$SERVER_NAME/privacy-policy" }
    
    location "/terms-and-conditions" { request rewrite "$REQUEST_URI.html" }
    location "/terms-and-conditions/" { block return 302 "https://$SERVER_NAME/terms-and-conditions" }

    location "/site-map" { request rewrite "$REQUEST_URI.html" }
    location "/site-map/" { block return 302 "https://$SERVER_NAME/site-map" }

    



    location "/*" {

        request rewrite "/page-not-found.html"
    }
    
   
}


