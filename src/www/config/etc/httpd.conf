ext_ip = "egress"

types {
  include "/usr/share/misc/mime.types"
}


server "s-expressions.org" {
    alias "www.s-expressions.org"
    
    listen on $ext_ip port 80

    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    block return 301 "https://$SERVER_NAME$REQUEST_URI"
}

server "s-expressions.org" {

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }
    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    block return 302 "https://www.$SERVER_NAME$REQUEST_URI"
}


server "www.s-expressions.org" {

    listen on $ext_ip tls port 443

    tls {
        certificate "/etc/ssl/org.s-expressions.fullchain.pem"
        key "/etc/ssl/private/org.s-expressions.key"
    }

    location "/.well-known/acme-challenge/*" {
        root "/acme"
        request strip 2
    }

    
    location "/sitemap.xml" {
        root "/htdocs/resources"
    }
    location "/robots.txt" {
        root "/htdocs/resources"
    }
    location "/favicon.ico" {
        root "/htdocs/resources/icons"
    }

    location "/icons/*" {
        root "/htdocs/resources"
    }

    location "/images/*" {
        root "/htdocs/resources"
    }

    location "/styles/*" {
        root "/htdocs/resources"
    }
    location "/scripts/*" {
        root "/htdocs/resources"
    }

    directory { auto index } 

    root "/htdocs/pages"

    location "/" {
        block return 301 "https://$SERVER_NAME/home"
#        request rewrite "/home.html"
    }

    location "/home" { request rewrite "$REQUEST_URI.html" }
    location "/organization" { request rewrite "$REQUEST_URI.html" }
    location "/standards" { request rewrite "$REQUEST_URI.html" }
    location "/projects" { request rewrite "$REQUEST_URI.html" }
    location "/contact" { request rewrite "$REQUEST_URI.html" }
    location "/privacy-policy" { request rewrite "$REQUEST_URI.html" }
    location "/terms-and-conditions" { request rewrite "$REQUEST_URI.html" }
    location "/site-map" { request rewrite "$REQUEST_URI.html" }


    location "/*" {

        request rewrite "/page-not-found.html"
    }
    
   
}




